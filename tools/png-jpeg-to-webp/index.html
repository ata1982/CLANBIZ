<!DOCTYPE html>
<html lang="ja">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta name="description" content="まえゆきツールのWebP変換ツール - JPEG・PNG画像をまとめてWebP形式に変換できる無料ツールです。">
   <title>WebP変換ツール | まえゆきツール</title>
   
   <!-- リソースの先読み -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   
   <!-- クリティカルCSS インライン化 -->
   <style>
     :root{--primary:#0066ff;--secondary:#ff3a3a;--accent:#ff9500;--dark-blue:#0d3283;--light-bg:#f8f9fa;--text-dark:#333;--text-mid:#555;--header-h:60px}*,::after,::before{box-sizing:border-box;margin:0;padding:0}body{font:16px/1.6 'Noto Sans JP',sans-serif;color:var(--text-dark);background:#fff;overflow-x:hidden;display:flex;flex-direction:column;min-height:100vh;-webkit-text-size-adjust:100%}img{max-width:100%;height:auto;vertical-align:middle;border:0}a{text-decoration:none;color:inherit}ul{list-style:none}main{flex:1 0 auto}.site-header{position:fixed;top:0;left:0;width:100%;z-index:1000;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.1);height:var(--header-h);display:flex;align-items:center}.header-container{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center;width:100%}.site-logo-text{font-weight:700;font-size:20px}.site-logo-text a{color:var(--dark-blue)}.hamburger-button{display:block;width:30px;height:30px;position:relative;z-index:1001;border:0;background:0;cursor:pointer}.hamburger-button span{display:block;position:absolute;width:100%;height:2px;background:var(--text-dark);left:0}.hamburger-button span:nth-child(1){top:8px}.hamburger-button span:nth-child(2){top:14px}.hamburger-button span:nth-child(3){bottom:8px}

     /* WebP変換ツールスタイル */
     .tool-section {
         padding: 80px 0 40px;
         margin-top: var(--header-h);
         background: #f9f3e9;
     }
     .tool-container {
         max-width: 840px;
         margin: 0 auto;
         padding: 0 20px;
     }
     .tool-title {
         font-size: 28px;
         text-align: center;
         margin-bottom: 1rem;
         color: var(--text-dark);
     }
     .tool-subtitle {
         font-size: 16px;
         color: var(--text-mid);
         text-align: center;
         margin-bottom: 8px;
     }
     .tool-label {
         font-size: 12px;
         display: table;
         margin: 0 auto;
         padding: 4px 10px;
         border-radius: 15px;
         background: var(--text-mid);
         color: #fff;
         letter-spacing: .05em;
     }

     /* ステップスタイル */
     .step-section {
         background: #fff;
         border-radius: 10px;
         padding: 25px;
         position: relative;
         margin-top: 30px;
         box-shadow: 0 4px 10px rgba(0,0,0,0.05);
     }
     .step-number {
         position: absolute;
         left: -10px;
         top: -10px;
         display: flex;
         align-items: center;
         justify-content: center;
         width: 30px;
         height: 30px;
         font-weight: 700;
         text-align: center;
         background: var(--primary);
         color: #fff;
         border-radius: 50%;
         font-size: 16px;
     }
     .step-title {
         font-size: 18px;
         margin-bottom: 10px;
         line-height: 1.3;
     }
     .step-description {
         font-size: 14px;
         color: var(--text-mid);
         margin-bottom: 15px;
     }
     
     /* ドロップエリア */
     .drop-area {
         border: 2px dashed #ccc;
         background: #f8f8f8;
         padding: 30px 20px;
         text-align: center;
         border-radius: 8px;
         margin-top: 15px;
         transition: all 0.3s;
     }
     .drop-area.dragover {
         border-color: var(--primary);
         background: rgba(0, 102, 255, 0.05);
     }
     .drop-area-icon {
         font-size: 32px;
         color: #ccc;
         margin-bottom: 10px;
     }
     .drop-area-text {
         margin-bottom: 5px;
         color: var(--text-mid);
     }
     .drop-area-or {
         font-size: 12px;
         color: var (--text-mid);
         margin-bottom: 10px;
     }
     .file-button {
         display: inline-block;
         padding: 10px 20px;
         background: var(--primary);
         color: #fff;
         border-radius: 8px;
         font-weight: 700;
         cursor: pointer;
         transition: all 0.3s;
     }
     .file-button:hover {
         background: #0055d4;
     }
     .file-input {
         display: none;
     }
     
     /* ファイルサムネイル */
     .files-container {
         display: flex;
         flex-wrap: wrap;
         gap: 15px;
         margin-top: 15px;
     }
     .file-item {
         width: 100px;
         position: relative;
     }
     .file-preview {
         width: 100px;
         height: 100px;
         border-radius: 5px;
         object-fit: cover;
         border: 1px solid #eee;
     }
     .file-name {
         font-size: 10px;
         text-align: center;
         margin-top: 5px;
         overflow: hidden;
         text-overflow: ellipsis;
         white-space: nowrap;
     }
     .file-remove {
         position: absolute;
         top: -5px;
         right: -5px;
         width: 20px;
         height: 20px;
         border-radius: 50%;
         background: rgba(255, 0, 0, 0.7);
         color: white;
         display: flex;
         align-items: center;
         justify-content: center;
         font-size: 14px;
         cursor: pointer;
     }
     .files-meta {
         font-size: 14px;
         margin: 15px 0 0;
         color: var(--text-mid);
     }
     
     /* 設定フォーム */
     .settings-container {
         display: flex;
         flex-wrap: wrap;
         gap: 20px;
         margin-top: 15px;
     }
     .setting-row {
         flex: 1;
         min-width: 250px;
     }
     .setting-title {
         display: flex;
         align-items: center;
         font-weight: 700;
         margin-bottom: 5px;
     }
     .setting-icon {
         color: var(--primary);
         margin-right: 5px;
         font-size: 14px;
     }
     .setting-input {
         display: flex;
         align-items: center;
     }
     .quality-slider {
         width: 100%;
         height: 5px;
         -webkit-appearance: none;
         background: #ddd;
         outline: none;
         border-radius: 5px;
     }
     .quality-slider::-webkit-slider-thumb {
         -webkit-appearance: none;
         width: 18px;
         height: 18px;
         border-radius: 50%;
         background: var(--primary);
         cursor: pointer;
     }
     .quality-slider::-moz-range-thumb {
         width: 18px;
         height: 18px;
         border-radius: 50%;
         background: var(--primary);
         cursor: pointer;
         border: none;
     }
     .quality-value {
         min-width: 40px;
         text-align: center;
         font-weight: 700;
         margin-left: 10px;
     }
     
     /* アクションボタン */
     .action-container {
         margin-top: 20px;
         text-align: center;
     }
     .convert-button, .download-button {
         display: inline-block;
         padding: 10px 25px;
         font-weight: 700;
         font-size: 16px;
         border-radius: 8px;
         cursor: pointer;
         transition: all 0.3s;
         border: none;
     }
     .convert-button {
         background: var(--primary);
         color: #fff;
     }
     .convert-button:hover:not(:disabled) {
         background: #0055d4;
     }
     .convert-button:disabled {
         background: #ccc;
         cursor: not-allowed;
     }
     .download-button {
         background: var(--text-dark);
         color: #fff;
     }
     .download-button:hover:not(:disabled) {
         opacity: 0.9;
     }
     .download-button:disabled {
         background: #ccc;
         cursor: not-allowed;
     }
     
     /* 変換結果テーブル */
     .result-table {
         width: 100%;
         margin-top: 20px;
         border-collapse: collapse;
     }
     .result-table th, .result-table td {
         padding: 8px;
         text-align: left;
         border-bottom: 1px solid #eee;
     }
     .result-table th {
         font-weight: 700;
         background: #f5f5f5;
     }
     .file-size-reduction {
         color: #00a389;
         font-weight: 700;
     }
     
     /* 使い方ボックス */
     .usage-box {
         background: #fff;
         border-radius: 10px;
         padding: 25px;
         margin-top: 40px;
         box-shadow: 0 4px 10px rgba(0,0,0,0.05);
     }
     .usage-title {
         font-size: 18px;
         display: flex;
         align-items: center;
         margin-bottom: 15px;
         color: var(--text-dark);
     }
     .usage-title-icon {
         margin-right: 8px;
         color: var(--primary);
     }
     .usage-list {
         padding-left: 20px;
     }
     .usage-item {
         margin-bottom: 8px;
         position: relative;
         line-height: 1.5;
     }
     .usage-item::before {
         content: "•";
         position: absolute;
         left: -15px;
         color: var(--primary);
     }
     .usage-link {
         color: var(--primary);
     }
     .usage-link:hover {
         text-decoration: underline;
     }
     
     /* シェアセクション */
     .share-section {
         margin: 40px 0;
         text-align: center;
     }
     .share-title {
         display: inline-block;
         position: relative;
         padding: 0 30px;
         margin-bottom: 15px;
         font-size: 16px;
         font-weight: 700;
     }
     .share-title:before, .share-title:after {
         content: "";
         position: absolute;
         top: 50%;
         width: 20px;
         height: 2px;
         background: var(--text-dark);
     }
     .share-title:before {
         left: 0;
         transform: rotate(50deg);
     }
     .share-title:after {
         right: 0;
         transform: rotate(-50deg);
     }
     .share-buttons {
         display: flex;
         justify-content: center;
         gap: 15px;
     }
     .share-button {
         display: flex;
         align-items: center;
         justify-content: center;
         width: 40px;
         height: 40px;
         border-radius: 50%;
         transition: transform 0.2s;
     }
     .share-button:hover {
         transform: scale(1.1);
     }
     .share-twitter { background: #1DA1F2; }
     .share-facebook { background: #1877F2; }
     .share-line { background: #06C755; }
     
     /* 他のツールリンク */
     .other-tools {
         margin-top: 40px;
     }
     .other-tools-title {
         font-size: 18px;
         margin-bottom: 15px;
         text-align: center;
     }
     .tools-list {
         display: flex;
         flex-wrap: wrap;
         gap: 10px;
         justify-content: center;
     }
     .tool-link {
         display: inline-block;
         padding: 8px 16px;
         background: white;
         border-radius: 20px;
         border: 1px solid #e0e0e0;
         font-size: 14px;
         transition: all 0.2s;
     }
     .tool-link:hover {
         background: var(--primary);
         color: white;
         transform: translateY(-2px);
         border-color: var(--primary);
     }
     
     /* レスポンシブ対応 */
     @media (max-width: 768px) {
         .tool-section {
             padding: 70px 0 30px;
         }
         .step-section {
             padding: 20px 15px;
         }
         .settings-container {
             flex-direction: column;
         }
         .setting-row {
             width: 100%;
         }
     }
     @media (max-width: 480px) {
         .files-container {
             justify-content: center;
         }
     }
   </style>
   
   <!-- 非クリティカルCSSは非同期ロード -->
   <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all'">
   
   <!-- JavaScriptの遅延ロード -->
   <script src="/js/script.js" defer></script>
   
   <!-- フォールバック -->
   <noscript>
     <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
     <link rel="stylesheet" href="/css/style.css">
   </noscript>
   
   <link rel="icon" href="/images/favicon.ico">
   <meta property="og:title" content="WebP変換ツール | まえゆきツール">
   <meta property="og:description" content="JPEG・PNG画像をまとめてWebP形式に変換できる無料ツールです。">
   <meta property="og:image" content="/images/ogp_image_tools.webp">
   <meta property="og:type" content="website">
</head>
<body>
<div id="svg-defs-placeholder"></div>
<header class="site-header">
  <div class="header-container">
    <div class="site-logo-text">
      <a href="/index.html">CLAN</a>
    </div>
    <nav class="global-nav pc-nav">
      <ul>
        <li><a href="/index.html">ホーム</a></li>
        <li><a href="/about.html">オートファネル大学とは</a></li>
        <li><a href="/blog/index.html">ブログ</a></li>
        <li><a href="/seminar/index.html">オンライン講座</a></li>
        <li><a href="/tools/index.html" aria-current="page">まえゆきツール</a></li>
        <li><a href="/achievement/index.html">お客様の声</a></li>
      </ul>
    </nav>
    <div class="header-cta">
      <a href="/document.html" class="btn-document">
        <svg width="14" height="14"><use xlink:href="#icon-pdf"></use></svg>
        資料請求する
      </a>
      <a href="https://utage-marunage.com/it-hojo/" class="btn-contact">
        まずは相談する
      </a>
    </div>
    <button class="hamburger-button sp-nav" aria-label="メニューを開く">
      <span></span><span></span><span></span>
    </button>
  </div>
</header>
<div id="header-placeholder"></div>
   <main class="site-main">
      <!-- ツールセクション -->
      <section class="tool-section">
         <div class="tool-container">
            <h1 class="tool-title">WebP変換ツール</h1>
            <p class="tool-subtitle">Web上で一括変換！</p>
            <span class="tool-label">JPEG/PNG対応</span>

            <!-- ステップ1: 画像選択 -->
            <div class="step-section">
               <span class="step-number">1</span>
               <h2 class="step-title">WebPに変換する画像を選択</h2>
               <p class="step-description">複数枚を一括でまとめて選択できます。JPEG/PNG/GIFなどの画像に対応。</p>
               
               <div class="drop-area" id="dropArea">
                  <div class="drop-area-icon">
                     <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                     </svg>
                  </div>
                  <p class="drop-area-text">ここに画像ファイルをドラッグ＆ドロップ</p>
                  <p class="drop-area-or">もしくは</p>
                  <label class="file-button">
                     + ファイルを追加
                     <input type="file" class="file-input" id="fileInput" accept="image/jpeg, image/png, image/gif" multiple>
                  </label>
               </div>

               <div class="files-meta" id="filesMeta"></div>
               <div class="files-container" id="filesContainer"></div>
            </div>

            <!-- 品質設定 -->
            <div class="step-section">
               <span class="step-number">2</span>
               <h2 class="step-title">WebP変換の設定</h2>
               <p class="step-description">WebP画像の品質を調整できます。品質を下げるとファイルサイズが小さくなります。</p>
               
               <div class="settings-container">
                  <div class="setting-row">
                     <div class="setting-title">
                        <span class="setting-icon">◎</span> WebP品質
                     </div>
                     <div class="setting-input">
                        <input type="range" id="qualitySlider" class="quality-slider" min="10" max="100" value="80" step="5">
                        <div class="quality-value" id="qualityValue">80%</div>
                     </div>
                  </div>
               </div>
               
               <div class="action-container">
                  <button class="convert-button" id="convertBtn" disabled>→ WebPに変換する</button>
               </div>
            </div>

            <!-- ステップ3: ダウンロード -->
            <div class="step-section">
               <span class="step-number">3</span>
               <h2 class="step-title">WebP画像を一括ダウンロード</h2>
               <p class="step-description">変換後のWebP画像をZIPファイルとしてダウンロードできます。</p>
               
               <div class="action-container">
                  <a class="download-button" id="downloadBtn" disabled>↓ 全てダウンロード（zip）</a>
               </div>
               
               <div id="resultTableContainer"></div>
            </div>

            <!-- 使い方ボックス -->
            <div class="usage-box">
               <h3 class="usage-title">
                  <span class="usage-title-icon">
                     <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                     </svg>
                  </span>
                  WebP変換ツールの使い方
               </h3>
               
               <ul class="usage-list">
                  <li class="usage-item">Web（ブラウザ）上ですぐに使えるWebP変換ツールです。</li>
                  <li class="usage-item">複数のJPEG、PNG、GIFなどの画像をまとめてWebP形式に変換します。</li>
                  <li class="usage-item">WebPはGoogleが開発している<a href="https://developers.google.com/speed/webp" class="usage-link" target="_blank" rel="noopener noreferrer">軽量な画像形式</a>です。</li>
                  <li class="usage-item">ウェブでのWebP表示には<a href="https://code-kitchen.dev/html/picture/" class="usage-link" target="_blank" rel="noopener noreferrer">pictureタグ</a>を使うと良いでしょう。</li>
                  <li class="usage-item">ファイルの拡張子は◯◯.webpに変換されます。</li>
                  <li class="usage-item">画像はパソコンやスマホのブラウザ上で処理されます。</li>
                  <li class="usage-item">サーバーなどにも画像は送信されないため、画像を誰かに見られる心配はありません。</li>
                  <li class="usage-item">
                     <a href="../tools/image-resize/" class="usage-link">画像サイズ変更ツール</a>や
                     <a href="../tools/png-to-jpeg/" class="usage-link">PNG→JPEG変換ツール</a>もぜひご利用ください。
                  </li>
               </ul>
            </div>
         </div>
      </section>

      <!-- Contact CTA Section -->
      <section class="contact-cta-section">
         <div class="contact-cta-container">
            <span class="contact-cta-subtitle">IT導入補助金2025活用可能</span>
            <h2 class="contact-cta-title">申請は完全丸投げOK！</h2>
            <p class="contact-cta-lead">
               UTAGEの導入で最大450万円の補助金が受けられます。<br class="pc-only">
               面倒な申請手続きはすべてお任せください。<br class="pc-only">
               あなたは事業成長に集中するだけでOKです。
            </p>
            <div class="contact-cta-buttons">
               <a href="https://utage-marunage.com/it-hojo/" class="btn btn-contact">
                  無料相談してみる
               </a>
               <a href="../document.html" class="btn btn-document">
                  <svg width="14" height="14"><use xlink:href="#icon-pdf"></use></svg>
                  資料請求する
               </a>
            </div>
         </div>
      </section>
   </main>
<div id="footer-placeholder"></div>
<script src="/js/include.js"></script>
<script src="/js/script.js"></script>
   <!-- JSZipの読み込み -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

   <!-- WebP変換用JavaScript -->
   <script>
      document.addEventListener('DOMContentLoaded', function() {
          // 要素の参照
          const dropArea = document.getElementById('dropArea');
          const fileInput = document.getElementById('fileInput');
          const filesContainer = document.getElementById('filesContainer');
          const filesMeta = document.getElementById('filesMeta');
          const qualitySlider = document.getElementById('qualitySlider');
          const qualityValue = document.getElementById('qualityValue');
          const convertBtn = document.getElementById('convertBtn');
          const downloadBtn = document.getElementById('downloadBtn');
          const resultTableContainer = document.getElementById('resultTableContainer');
          
          // 状態管理
          let selectedFiles = [];
          let convertedImages = [];
          let quality = 80;
          
          // WebPサポートチェック
          function checkWebPSupport() {
              const canvas = document.createElement('canvas');
              if (!canvas.getContext || !canvas.getContext('2d')) {
                  return false;
              }
              
              return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;
          }
          
          // WebPがサポートされていない場合の処理
          if (!checkWebPSupport()) {
              const errorMessage = document.createElement('div');
              errorMessage.className = 'error-message';
              errorMessage.style.color = '#f00';
              errorMessage.style.padding = '10px';
              errorMessage.style.marginTop = '20px';
              errorMessage.style.background = '#ffeeee';
              errorMessage.style.borderRadius = '5px';
              errorMessage.innerHTML = '<strong>ご利用のブラウザはWebP形式をサポートしていません。</strong><br>Google Chrome、Microsoft Edgeなど、最新のブラウザでご利用ください。';
              
              dropArea.parentNode.appendChild(errorMessage);
              dropArea.style.opacity = '0.5';
              convertBtn.disabled = true;
              downloadBtn.disabled = true;
              return;
          }
          
          // ドラッグ&ドロップイベント
          ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
              dropArea.addEventListener(eventName, preventDefaults, false);
          });
          
          function preventDefaults(e) {
              e.preventDefault();
              e.stopPropagation();
          }
          
          ['dragenter', 'dragover'].forEach(eventName => {
              dropArea.addEventListener(eventName, highlight, false);
          });
          
          ['dragleave', 'drop'].forEach(eventName => {
              dropArea.addEventListener(eventName, unhighlight, false);
          });
          
          function highlight() {
              dropArea.classList.add('dragover');
          }
          
          function unhighlight() {
              dropArea.classList.remove('dragover');
          }
          
          // ファイルのドロップ
          dropArea.addEventListener('drop', handleDrop, false);
          
          function handleDrop(e) {
              const dt = e.dataTransfer;
              const files = dt.files;
              handleFiles(files);
          }
          
          // ファイル選択
          fileInput.addEventListener('change', function() {
              handleFiles(this.files);
          });
          
          // ファイル処理
          function handleFiles(files) {
              const validFiles = Array.from(files).filter(file => {
                  const type = file.type.toLowerCase();
                  return type === 'image/jpeg' || type === 'image/png' || type === 'image/gif';
              });
              
              if (validFiles.length === 0) return;
              
              // 既存のファイルに追加
              selectedFiles = [...selectedFiles, ...validFiles];
              
              // UIを更新
              updateFilesUI();
              updateFilesMetaUI();
              
              // 変換ボタンを有効化
              convertBtn.disabled = selectedFiles.length === 0;
          }
          
          // ファイルUI更新
          function updateFilesUI() {
              filesContainer.innerHTML = '';
              
              selectedFiles.forEach((file, index) => {
                  const fileItem = document.createElement('div');
                  fileItem.className = 'file-item';
                  
                  const filePreview = document.createElement('img');
                  filePreview.className = 'file-preview';
                  filePreview.alt = file.name;
                  
                  // ファイルプレビュー作成
                  const reader = new FileReader();
                  reader.onload = function(e) {
                      filePreview.src = e.target.result;
                  };
                  reader.readAsDataURL(file);
                  
                  const fileName = document.createElement('div');
                  fileName.className = 'file-name';
                  fileName.textContent = file.name;
                  
                  const removeBtn = document.createElement('div');
                  removeBtn.className = 'file-remove';
                  removeBtn.innerHTML = '×';
                  removeBtn.addEventListener('click', () => {
                      selectedFiles.splice(index, 1);
                      updateFilesUI();
                      updateFilesMetaUI();
                      convertBtn.disabled = selectedFiles.length === 0;
                  });
                  
                  fileItem.appendChild(filePreview);
                  fileItem.appendChild(fileName);
                  fileItem.appendChild(removeBtn);
                  filesContainer.appendChild(fileItem);
              });
          }
          
          // ファイルメタ情報更新
          function updateFilesMetaUI() {
              if (selectedFiles.length === 0) {
                  filesMeta.textContent = '';
                  return;
              }
              
              let totalSize = 0;
              selectedFiles.forEach(file => {
                  totalSize += file.size;
              });
              
              const sizeInMB = (totalSize / (1024 * 1024)).toFixed(2);
              filesMeta.textContent = `${selectedFiles.length}枚の画像（合計 ${sizeInMB} MB）`;
          }
          
          // 品質スライダー
          qualitySlider.addEventListener('input', function() {
              quality = parseInt(this.value);
              qualityValue.textContent = `${quality}%`;
          });
          
          // 変換ボタン
          convertBtn.addEventListener('click', async function() {
              if (selectedFiles.length === 0) return;
              
              convertBtn.disabled = true;
              convertBtn.textContent = '変換中...';
              
              // 変換結果をクリア
              convertedImages = [];
              
              // 表示用の結果テーブルを準備
              resultTableContainer.innerHTML = `
                  <table class="result-table">
                      <thead>
                          <tr>
                              <th>元のファイル</th>
                              <th>元のサイズ</th>
                              <th>WebPサイズ</th>
                              <th>削減率</th>
                          </tr>
                      </thead>
                      <tbody id="resultTableBody">
                      </tbody>
                  </table>
              `;
              
              const resultTableBody = document.getElementById('resultTableBody');
              
              // 各画像を変換
              for (let i = 0; i < selectedFiles.length; i++) {
                  const file = selectedFiles[i];
                  try {
                      const webpBlob = await convertToWebP(file, quality);
                      
                      // 元のファイル名から拡張子を取り除き、.webpを追加
                      const originalName = file.name;
                      const baseName = originalName.substring(0, originalName.lastIndexOf('.')) || originalName;
                      const webpName = `${baseName}.webp`;
                      
                      // 変換結果を保存
                      convertedImages.push({
                          name: webpName,
                          blob: webpBlob,
                          originalSize: file.size,
                          webpSize: webpBlob.size
                      });
                      
                      // 結果テーブルに追加
                      const row = document.createElement('tr');
                      
                      const originalSizeKB = (file.size / 1024).toFixed(1);
                      const webpSizeKB = (webpBlob.size / 1024).toFixed(1);
                      const reductionPercent = ((1 - webpBlob.size / file.size) * 100).toFixed(1);
                      
                      row.innerHTML = `
                          <td>${originalName}</td>
                          <td>${originalSizeKB} KB</td>
                          <td>${webpSizeKB} KB</td>
                          <td class="file-size-reduction">${reductionPercent}%</td>
                      `;
                      
                      resultTableBody.appendChild(row);
                  } catch (err) {
                      console.error('変換エラー:', err);
                      
                      // エラー行を追加
                      const errorRow = document.createElement('tr');
                      errorRow.innerHTML = `
                          <td>${file.name}</td>
                          <td colspan="3" style="color: red;">変換エラー</td>
                      `;
                      resultTableBody.appendChild(errorRow);
                  }
              }
              
              // 変換完了
              convertBtn.textContent = '変換完了!';
              downloadBtn.disabled = convertedImages.length === 0;
              
              setTimeout(() => {
                  convertBtn.textContent = '→ WebPに変換する';
                  convertBtn.disabled = false;
              }, 2000);
          });
          
          // WebP形式に変換
          function convertToWebP(file, quality) {
              return new Promise((resolve, reject) => {
                  const img = new Image();
                  img.onload = function() {
                      const canvas = document.createElement('canvas');
                      canvas.width = img.width;
                      canvas.height = img.height;
                      
                      const ctx = canvas.getContext('2d');
                      ctx.drawImage(img, 0, 0);
                      
                      // WebPに変換
                      canvas.toBlob(blob => {
                          if (blob) {
                              resolve(blob);
                          } else {
                              reject(new Error('WebP変換に失敗しました'));
                          }
                      }, 'image/webp', quality / 100);
                  };
                  
                  img.onerror = () => reject(new Error('画像の読み込みに失敗しました'));
                  
                  // 画像読み込み
                  const reader = new FileReader();
                  reader.onload = e => {
                      img.src = e.target.result;
                  };
                  reader.onerror = () => reject(new Error('ファイルの読み込みに失敗しました'));
                  reader.readAsDataURL(file);
              });
          }
          
          // ダウンロードボタン
          downloadBtn.addEventListener('click', function(e) {
              if (convertedImages.length === 0) {
                  e.preventDefault();
                  return;
              }
              
              // 単一画像の場合は直接ダウンロード
              if (convertedImages.length === 1) {
                  const url = URL.createObjectURL(convertedImages[0].blob);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = convertedImages[0].name;
                  document.body.appendChild(a);
                  a.click();
                  document.body.removeChild(a);
                  URL.revokeObjectURL(url);
                  return;
              }
              
              // 複数画像の場合はZIPでダウンロード
              e.preventDefault();
              
              const zip = new JSZip();
              
              // 画像をZIPに追加
              convertedImages.forEach(image => {
                  zip.file(image.name, image.blob);
              });
              
              // ZIPを生成してダウンロード
              zip.generateAsync({ type: 'blob' }).then(content => {
                  const url = URL.createObjectURL(content);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = `webp_images_${new Date().toISOString().slice(0, 10)}.zip`;
                  document.body.appendChild(a);
                  a.click();
                  document.body.removeChild(a);
                  URL.revokeObjectURL(url);
              });
          });
      });
   </script>
</body>
</html>