<!DOCTYPE html>
<html lang="ja">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta name="description" content="まえゆきツールの画像サイズ変更ツール - ブラウザ上でJPEG・PNG画像をまとめてリサイズ・縮小できる無料ツールです。">
   <title>画像サイズ変更ツール | まえゆきツール</title>
   
   <!-- リソースの先読み -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   
   <!-- クリティカルCSS インライン化 -->
   <style>
     /* 画像リサイズツール固有のデザインのみ残す（共通UI部品はstyle.cssへ移動済み） */
     .tool-section {
         padding: 80px 0 40px;
         margin-top: var(--header-h);
         background: #f9f3e9;
     }
     .tool-container {
         max-width: 840px;
         margin: 0 auto;
         padding: 0 20px;
     }
     .tool-title {
         font-size: 28px;
         text-align: center;
         margin-bottom: 1rem;
         color: var(--text-dark);
     }
     .tool-subtitle {
         font-size: 16px;
         color: var(--text-mid);
         text-align: center;
         margin-bottom: 8px;
     }
     .tool-label {
         font-size: 12px;
         display: table;
         margin: 0 auto;
         padding: 4px 10px;
         border-radius: 15px;
         background: var(--text-mid);
         color: #fff;
         letter-spacing: .05em;
     }
     /* 以下、固有部分があれば追記 */
   </style>
   
   <!-- 非クリティカルCSSは非同期ロード -->
   <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all'">
   
   <!-- JavaScriptの遅延ロード -->
   <script src="/js/script.js" defer></script>
   
   <!-- フォールバック -->
   <noscript>
     <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
     <link rel="stylesheet" href="/css/style.css">
   </noscript>
   
   <link rel="icon" href="/images/favicon.ico">
   <meta property="og:title" content="画像サイズ変更ツール | まえゆきツール">
   <meta property="og:description" content="ブラウザ上でJPEG・PNG画像をまとめてリサイズ・縮小できる無料ツールです。">
   <meta property="og:image" content="/images/ogp_image_tools.webp">
   <meta property="og:type" content="website">
</head>
<body>
<div id="svg-defs-placeholder"></div>
<div id="header-placeholder"></div>
   <main class="site-main">
      <!-- ツールセクション -->
      <section class="tool-section">
         <div class="tool-container">
            <h1 class="tool-title">画像サイズ変更ツール</h1>
            <p class="tool-subtitle">Webで画像サイズを一括縮小！</p>
            <span class="tool-label">JPEG/PNG対応</span>

            <!-- ステップ1: 画像選択 -->
            <div class="step-section">
               <span class="step-number">1</span>
               <h2 class="step-title">サイズ変更する画像を選択</h2>
               <p class="step-description">複数枚を一括で縮小できます。JPEGもPNGもまとめてどうぞ！</p>
               
               <div class="drop-area" id="dropArea">
                  <div class="drop-area-icon">
                     <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                     </svg>
                  </div>
                  <p class="drop-area-text">ここに画像ファイルをドラッグ＆ドロップ</p>
                  <p class="drop-area-or">もしくは</p>
                  <label class="file-button">
                     + ファイルを追加
                     <input type="file" class="file-input" id="fileInput" accept="image/jpeg, image/png, image/gif" multiple>
                  </label>
               </div>

               <div class="files-meta" id="filesMeta"></div>
               <div class="files-container" id="filesContainer"></div>
            </div>

            <!-- ステップ2: 設定 -->
            <div class="step-section">
               <span class="step-number">2</span>
               <h2 class="step-title">指定したサイズに縮小</h2>
               <p class="step-description">縦横比を保ったままサイズ変更します。</p>
               
               <div class="settings-container">
                  <div class="setting-row">
                     <div class="setting-title">
                        <span class="setting-icon">↔</span> 画像の最大幅
                     </div>
                     <div class="setting-input">
                        <input type="number" id="maxWidth" class="size-input" value="1200" min="1">
                        <span class="size-unit">px</span>
                        <span class="size-note">（ピクセル）</span>
                     </div>
                  </div>
                  
                  <div class="setting-row">
                     <div class="setting-title">
                        <span class="setting-icon">↕</span> 画像の最大高
                     </div>
                     <div class="setting-input" id="maxHeightContainer">
                        <button class="no-setting-btn" id="toggleMaxHeight">
                           指定なし
                           <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
                              <path d="M12 20h9"></path>
                              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                           </svg>
                        </button>
                     </div>
                  </div>
                  
                  <div class="setting-row">
                     <div class="setting-title">
                        <span class="setting-icon">◎</span> 画質
                     </div>
                     <div class="quality-buttons" id="qualityBtns">
                        <button class="quality-btn" data-quality="20">低</button>
                        <button class="quality-btn" data-quality="50">中</button>
                        <button class="quality-btn" data-quality="80">高</button>
                        <button class="quality-btn active" data-quality="100">最高</button>
                     </div>
                  </div>
               </div>
               
               <div class="action-container">
                  <button class="resize-button" id="resizeBtn" disabled>→ リサイズする</button>
               </div>
            </div>

            <!-- ステップ3: ダウンロード -->
            <div class="step-section">
               <span class="step-number">3</span>
               <h2 class="step-title">画像を一括ダウンロード</h2>
               
               <div class="action-container">
                  <a class="download-button" id="downloadBtn" disabled>↓ 全てダウンロード（zip）</a>
               </div>
            </div>

            <!-- 使い方ボックス -->
            <div class="usage-box">
               <h3 class="usage-title">
                  <span class="usage-title-icon">
                     <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 20h9"></path>
                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                     </svg>
                  </span>
                  画像のサイズ変更の仕方
               </h3>
               
               <ul class="usage-list">
                  <li class="usage-item">Web（ブラウザ）で使える画像リサイズツールです。</li>
                  <li class="usage-item">JPEG/PNG/GIF画像を複数選択して縮小できます。</li>
                  <li class="usage-item">画像の選択後、最大幅や最大高を指定してください。</li>
                  <li class="usage-item">たとえば、最大幅を500にすると、画像の横幅が500pxになります。</li>
                  <li class="usage-item">画像の縦横比は固定です。比率が崩れる心配はありません。</li>
                  <li class="usage-item">もともとの画像の大きさが指定されたサイズ以下の場合にはリサイズはスキップされます。</li>
                  <li class="usage-item">[リサイズする]ボタンを押すと全画像が指定サイズに変更されます。</li>
                  <li class="usage-item">リサイズ後の画像はzipファイルとして一括ダウンロードもできます。</li>
                  <li class="usage-item">画像はパソコンやスマホのブラウザ上で処理されます。</li>
                  <li class="usage-item">サーバーなどにも送信されないため、誰かに見られる心配はありません。</li>
                  <li class="usage-item">
                     <a href="../tools/png-to-jpeg/" class="usage-link">JPEG変換ツール</a>や
                     <a href="../tools/png-jpeg-to-webp/" class="usage-link">WebP変換ツール</a>もぜひご利用ください。
                  </li>
               </ul>
            </div>
            
            <!-- シェアセクション -->
            <div class="share-section">
               <div class="share-title">シェア</div>
               <div class="share-buttons">
                  <a href="https://twitter.com/share?url=https://yourdomain.com/tools/image-resize/&text=%E7%94%BB%E5%83%8F%E3%82%B5%E3%82%A4%E3%82%BA%E5%A4%89%E6%9B%B4%E3%83%84%E3%83%BC%E3%83%AB%EF%BD%9C%E3%81%BE%E3%81%88%E3%82%86%E3%81%8D%E3%83%84%E3%83%BC%E3%83%AB" target="_blank" rel="nofollow noopener noreferrer" class="share-button share-twitter">
                     <svg width="20" height="20" fill="#fff" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
                  </a>
                  <a href="https://www.facebook.com/share.php?u=https://yourdomain.com/tools/image-resize/" target="_blank" rel="nofollow noopener noreferrer" class="share-button share-facebook">
                     <svg width="20" height="20" fill="#fff" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                  </a>
                  <a href="https://social-plugins.line.me/lineit/share?url=https://yourdomain.com/tools/image-resize/" target="_blank" rel="nofollow noopener noreferrer" class="share-button share-line">
                     <svg width="20" height="20" fill="#fff" viewBox="0 0 24 24"><path d="M24 10.304c0-5.369-5.383-9.738-12-9.738-6.616 0-12 4.369-12 9.738 0 4.814 4.269 8.846 10.036 9.608.391.084.922.258 1.057.592.121.303.079.778.039 1.085l-.171 1.027c-.053.303-.242 1.186 1.039.647 1.281-.54 6.911-4.069 9.428-6.967 1.739-1.907 2.572-3.843 2.572-5.992zm-18.988-2.595c.129 0 .234.105.234.234v4.153c0 .129-.105.234-.234.234h-.662c-.129 0-.234-.105-.234-.234v-4.153c0-.129.105-.234.234-.234zm5.323 0c.129 0 .234.105.234.234v4.153c0 .129-.105.234-.234.234h-.661c-.129 0-.234-.105-.234-.234v-2.566l-1.838 2.481c-.051.067-.131.107-.215.107h-.033c-.084 0-.164-.04-.215-.107l-1.838-2.481v2.566c0 .129-.105.234-.234.234h-.662c-.129 0-.234-.105-.234-.234v-4.153c0-.129.105-.234.234-.234h.66c.085 0 .165.04.216.109l2.081 2.811 2.081-2.811c.051-.069.131-.109.216-.109zm5.323 0c.129 0 .234.105.234.234v4.153c0 .129-.105.234-.234.234h-.662c-.129 0-.234-.105-.234-.234v-4.153c0-.129.105-.234.234-.234zm2.662 0c.129 0 .234.105.234.234v4.153c0 .129-.105.234-.234.234h-.662c-.129 0-.234-.105-.234-.234v-4.153c0-.129.105-.234.234-.234z"/></svg>
                  </a>
               </div>
            </div>
            
            <!-- 他のツールリンク -->
            <div class="other-tools">
               <h2 class="other-tools-title">その他のまえゆきツール</h2>
               <div class="tools-list">
                  <a href="../tools/calc/" class="tool-link">単位換算と計算</a>
                  <a href="../tools/countdown/" class="tool-link">Webでカウントダウン</a>
                  <a href="../tools/roulette/" class="tool-link">Webでルーレット</a>
                  <a href="../tools/bingo/" class="tool-link">ビンゴ・マシーン</a>
                  <a href="../tools/letters-counter/" class="tool-link">文字数カウント</a>
                  <a href="../tools/png-to-jpeg/" class="tool-link">PNG→JPEG変換</a>
               </div>
            </div>
         </div>
      </section>

      <!-- Contact CTA Section -->
      <section class="contact-cta-section">
         <div class="contact-cta-container">
            <span class="contact-cta-subtitle">IT導入補助金2025活用可能</span>
            <h2 class="contact-cta-title">申請は完全丸投げOK！</h2>
            <p class="contact-cta-lead">
               UTAGEの導入で最大450万円の補助金が受けられます。<br class="pc-only">
               面倒な申請手続きはすべてお任せください。<br class="pc-only">
               あなたは事業成長に集中するだけでOKです。
            </p>
            <div class="contact-cta-buttons">
               <a href="https://utage-marunage.com/it-hojo/" class="btn btn-contact">
                  無料相談してみる
               </a>
               <a href="../document.html" class="btn btn-document">
                  <svg width="14" height="14"><use xlink:href="#icon-pdf"></use></svg>
                  資料請求する
               </a>
            </div>
         </div>
      </section>
   </main>
<div id="footer-placeholder"></div>
   <!-- JSZipの読み込み -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

   <!-- 画像リサイズ用JavaScript -->
   <script>
      document.addEventListener('DOMContentLoaded', function() {
          // 要素の参照
          const dropArea = document.getElementById('dropArea');
          const fileInput = document.getElementById('fileInput');
          const filesContainer = document.getElementById('filesContainer');
          const filesMeta = document.getElementById('filesMeta');
          const maxWidthInput = document.getElementById('maxWidth');
          const maxHeightContainer = document.getElementById('maxHeightContainer');
          const toggleMaxHeight = document.getElementById('toggleMaxHeight');
          const qualityBtns = document.querySelectorAll('.quality-btn');
          const resizeBtn = document.getElementById('resizeBtn');
          const downloadBtn = document.getElementById('downloadBtn');
          
          // 状態管理
          let selectedFiles = [];
          let resizedImages = [];
          let quality = 100;
          let maxHeightEnabled = false;
          let maxHeight = 0;
          
          // ドラッグ&ドロップイベント
          ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
              dropArea.addEventListener(eventName, preventDefaults, false);
          });
          
          function preventDefaults(e) {
              e.preventDefault();
              e.stopPropagation();
          }
          
          ['dragenter', 'dragover'].forEach(eventName => {
              dropArea.addEventListener(eventName, highlight, false);
          });
          
          ['dragleave', 'drop'].forEach(eventName => {
              dropArea.addEventListener(eventName, unhighlight, false);
          });
          
          function highlight() {
              dropArea.classList.add('dragover');
          }
          
          function unhighlight() {
              dropArea.classList.remove('dragover');
          }
          
          // ファイルのドロップ
          dropArea.addEventListener('drop', handleDrop, false);
          
          function handleDrop(e) {
              const dt = e.dataTransfer;
              const files = dt.files;
              handleFiles(files);
          }
          
          // ファイル選択
          fileInput.addEventListener('change', function() {
              handleFiles(this.files);
          });
          
          // ファイル処理
          function handleFiles(files) {
              const validFiles = Array.from(files).filter(file => {
                  const type = file.type.toLowerCase();
                  return type === 'image/jpeg' || type === 'image/png' || type === 'image/gif';
              });
              
              if (validFiles.length === 0) return;
              
              // 既存のファイルに追加
              selectedFiles = [...selectedFiles, ...validFiles];
              
              // UIを更新
              updateFilesUI();
              updateFilesMetaUI();
              
              // リサイズボタンを有効化
              resizeBtn.disabled = selectedFiles.length === 0;
          }
          
          // ファイルUI更新
          function updateFilesUI() {
              filesContainer.innerHTML = '';
              
              selectedFiles.forEach((file, index) => {
                  const fileItem = document.createElement('div');
                  fileItem.className = 'file-item';
                  
                  const filePreview = document.createElement('img');
                  filePreview.className = 'file-preview';
                  filePreview.alt = file.name;
                  
                  // ファイルプレビュー作成
                  const reader = new FileReader();
                  reader.onload = function(e) {
                      filePreview.src = e.target.result;
                  };
                  reader.readAsDataURL(file);
                  
                  const fileName = document.createElement('div');
                  fileName.className = 'file-name';
                  fileName.textContent = file.name;
                  
                  const removeBtn = document.createElement('div');
                  removeBtn.className = 'file-remove';
                  removeBtn.innerHTML = '×';
                  removeBtn.addEventListener('click', () => {
                      selectedFiles.splice(index, 1);
                      updateFilesUI();
                      updateFilesMetaUI();
                      resizeBtn.disabled = selectedFiles.length === 0;
                  });
                  
                  fileItem.appendChild(filePreview);
                  fileItem.appendChild(fileName);
                  fileItem.appendChild(removeBtn);
                  filesContainer.appendChild(fileItem);
              });
          }
          
          // ファイルメタ情報更新
          function updateFilesMetaUI() {
              if (selectedFiles.length === 0) {
                  filesMeta.textContent = '';
                  return;
              }
              
              let totalSize = 0;
              selectedFiles.forEach(file => {
                  totalSize += file.size;
              });
              
              const sizeInMB = (totalSize / (1024 * 1024)).toFixed(2);
              filesMeta.textContent = `${selectedFiles.length}枚の画像（合計 ${sizeInMB} MB）`;
          }
          
          // 最大高さの設定切り替え
          toggleMaxHeight.addEventListener('click', function() {
              maxHeightEnabled = !maxHeightEnabled;
              
              if (maxHeightEnabled) {
                  // 入力フィールドに切り替え
                  maxHeightContainer.innerHTML = `
                      <input type="number" id="maxHeight" class="size-input" value="1200" min="1">
                      <span class="size-unit">px</span>
                      <span class="size-note">（ピクセル）</span>
                  `;
                  document.getElementById('maxHeight').value = maxWidthInput.value;
              } else {
                  // 指定なしに戻す
                  maxHeightContainer.innerHTML = `
                      <button class="no-setting-btn" id="toggleMaxHeight">
                         指定なし
                         <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 5px;">
                            <path d="M12 20h9"></path>
                            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                         </svg>
                      </button>
                  `;
                  document.getElementById('toggleMaxHeight').addEventListener('click', toggleMaxHeight.click.bind(toggleMaxHeight));
              }
          });
          
          // 画質設定
          qualityBtns.forEach(btn => {
              btn.addEventListener('click', function() {
                  qualityBtns.forEach(b => b.classList.remove('active'));
                  this.classList.add('active');
                  quality = parseInt(this.getAttribute('data-quality'));
              });
          });
          
          // リサイズボタン
          resizeBtn.addEventListener('click', async function() {
              if (selectedFiles.length === 0) return;
              
              resizeBtn.disabled = true;
              resizeBtn.textContent = '処理中...';
              
              // サイズ設定を取得
              const maxWidth = parseInt(maxWidthInput.value) || 1200;
              const maxHeight = maxHeightEnabled ? (parseInt(document.getElementById('maxHeight').value) || 1200) : 0;
              
              // 画像を非同期でリサイズ
              resizedImages = [];
              
              for (let i = 0; i < selectedFiles.length; i++) {
                  const file = selectedFiles[i];
                  try {
                      const resizedBlob = await resizeImage(file, maxWidth, maxHeight, quality);
                      resizedImages.push({
                          name: file.name,
                          blob: resizedBlob
                      });
                  } catch (err) {
                      console.error('リサイズエラー:', err);
                  }
              }
              
              // ダウンロードボタンを有効化
              downloadBtn.disabled = resizedImages.length === 0;
              
              // 処理完了表示
              resizeBtn.textContent = 'リサイズ完了!';
              setTimeout(() => {
                  resizeBtn.textContent = '→ リサイズする';
                  resizeBtn.disabled = false;
              }, 2000);
          });
          
          // 画像リサイズ処理
          function resizeImage(file, maxWidth, maxHeight, quality) {
              return new Promise((resolve, reject) => {
                  const img = new Image();
                  img.onload = function() {
                      // 元のサイズ
                      const origWidth = img.width;
                      const origHeight = img.height;
                      
                      // リサイズ後のサイズを計算
                      let newWidth = origWidth;
                      let newHeight = origHeight;
                      
                      // 最大幅に合わせてリサイズ
                      if (maxWidth > 0 && origWidth > maxWidth) {
                          newWidth = maxWidth;
                          newHeight = (origHeight * maxWidth) / origWidth;
                      }
                      
                      // 最大高さに合わせてリサイズ（もし指定があれば）
                      if (maxHeight > 0 && newHeight > maxHeight) {
                          newWidth = (newWidth * maxHeight) / newHeight;
                          newHeight = maxHeight;
                      }
                      
                      // リサイズの必要がなければ元の画像を返す
                      if (newWidth === origWidth && newHeight === origHeight) {
                          file.arrayBuffer().then(buffer => {
                              resolve(new Blob([buffer], { type: file.type }));
                          }).catch(reject);
                          return;
                      }
                      
                      // キャンバスでリサイズ
                      const canvas = document.createElement('canvas');
                      canvas.width = newWidth;
                      canvas.height = newHeight;
                      
                      const ctx = canvas.getContext('2d');
                      ctx.drawImage(img, 0, 0, newWidth, newHeight);
                      
                      // JPEG/PNGで出力
                      const mimeType = file.type;
                      
                      canvas.toBlob(blob => {
                          resolve(blob);
                      }, mimeType, quality / 100);
                  };
                  
                  img.onerror = reject;
                  
                  // 画像読み込み
                  const reader = new FileReader();
                  reader.onload = function(e) {
                      img.src = e.target.result;
                  };
                  reader.onerror = reject;
                  reader.readAsDataURL(file);
              });
          }
          
          // ダウンロードボタン
          downloadBtn.addEventListener('click', function(e) {
              if (resizedImages.length === 0) {
                  e.preventDefault();
                  return;
              }
              
              // 単一画像の場合は直接ダウンロード
              if (resizedImages.length === 1) {
                  const url = URL.createObjectURL(resizedImages[0].blob);
                  downloadBtn.href = url;
                  downloadBtn.download = `resized_${resizedImages[0].name}`;
                  return;
              }
              
              // 複数画像の場合はZIPでダウンロード
              e.preventDefault();
              
              const zip = new JSZip();
              
              // 画像をZIPに追加
              resizedImages.forEach(image => {
                  zip.file(image.name, image.blob);
              });
              
              // ZIPを生成してダウンロード
              zip.generateAsync({ type: 'blob' }).then(content => {
                  const url = URL.createObjectURL(content);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = `resized_images_${new Date().toISOString().slice(0, 10)}.zip`;
                  document.body.appendChild(a);
                  a.click();
                  document.body.removeChild(a);
                  URL.revokeObjectURL(url);
              });
          });
      });
   </script>
</body>
</html>